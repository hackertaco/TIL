# 2022/12/14: 데이터베이스를 잘 몰라서, 모델 부분 이해가 불가했다. 공부 후 알고리즘을 다시 공부해야한다.

웹 데이터 베이스의 제한적이고, 폼 형태같은 것으로만 접근이 가능한 특성을 극복하고, 집계를 미리 해 예측할 수 있다는 것이 확인이 되었다.
그럼에도, 그 기술은 데이터베이스가 항상 일정하다는 것을 상정하고 나온 것이라, 한계가 있다.
그래서,제한을 두고 이러한 집계하는 문제를 연구해볼 것이다.

## Introduction
이 논문에서는 동적 웹 데이터베이스 위에서 집계쿼리를 사용하는 기술을 발전시켜볼 것이다.

### 숨겨진 웹 데이터베이스
많은 웹 데이터베이스들이 제한된 검색 인터페이스에 숨어있다. 그리고 값을 많이 주지도 않는다.

### 동기 문제
제 3의 입장에서 제한적인 웹 인터페이스를 사용할 수 있을지를 고려한다. 

- 튜플 수를 체크하는 것 자체는 중요한 문제이다. 쉽게 트래킹할 수가 없다.
- 넓은 집계를 모니터링하는 것은 중요한 가치가 있다. 
- 경제적으로 주요한 집계는 변동이 심하다. 넓은 영역이 아님에도, 변동이 심한 COUNT, AVG가 있다. 

### 해결할 문제
집계 쿼리가 웹 인터페이스로 바로 제공되는 것이 아니라서, 제공되는 검색 쿼리를 여러개 결합해 예측하는수밖에 없다.
여러개의 서치쿼리를 잘게 쪼개서 집계 쿼리로 뭉쳐주는 방법은 이미 있다.
그러나, 동적 변화를 하는 데이터베이스를 서포팅하는 기술은 없다. 

반복적으로 데이터베이스를 분석하는 방법이 있겠으나, 큰 2가지 문제가 있다.
> 많은 웹 데이터베이스들이 IP별 로 검색 쿼리 수를 제한해놓았다. 

> 쿼리 수 제한 수가 높다고 하여도, 반복 작업은 사실 서치쿼리를 낭비한다. 반복 작업으로는 예측 에러가 계속 똑같이 남는다. 

다른 접근은 데이터베이스에서 발생하는 변화를 트래킹하는 것이다. 그러나, 이는 실세계에서 비용이 많이 든다(쿼리)

### 동적 집계 예측의 문제
이미 서치 쿼리를 날려서 집계하고 있을 때 동적 데이터베이스는 변경되었을지도 모른다.
언제 변경되는지도 모르는 이 상황에서, 라운드라는 개념을 도입해, 그 라운드가 시작할 때만 이론적으로 데이터베이스가 변한다고 가정한다.

### 결과 아웃라인
반복 작업이 아니라, 서치 쿼리 답을 추론하고자 한다.
자칫 모든 쿼리를 재발행하는 것 아닌지 의심을 할 수도 있으나, 하나의 쿼리 답은 충분히 변하지 않아서, 쿼리 비용을 크게 낮출 수 있다.
정확성에 대한 이슈도 있는데, 뒤의 라운드로 갈수록 이전 값을 업데이트 해야하는 의무가 있는 이 방법은 이전의 예측 에러를 바로잡는 게 어려울 수 있다.
그러나 많은 실험으로, 많이 데이터베이스가 바뀌었을지라도 정확성과 쿼리 비용사이에서 좋은 트레이드오프를 제공한다는 것을 알게되었다. 
이런 재이슈-예측기는 변하는 데이터베이스를 예측은 할 수 있지만, 여전히 쿼리를 낭비한다. 생각보다 많이 데이터베이스가 변하지는 않기 때문이다. 
그래서 RS-예측기를 만든다. 데이터베이스의 변화에 따라서 자동으로 데이터베이스 샘플을 유지한다. 
이 예측기는 이전 것에 비하여 덜 변하는 데이터베이스에서 더 좋은 결과를 보였다.

## 동기
기존 데이터베이스 모델을 설명하고, 집계 예측을 한다는 것의 목적을 정의한다.

1. 웹 데이터베이스 모델

   - overflowing 쿼리와 underflows쿼리가 있다. 
   - 동적 데이터베이스
   바뀌는 데이터베이스에 적응하기위해, 라운드라는 개념을 도입하였다. 
   G를 각 라운드별 쿼리 가능 개수라고 하고, 만약 그 수가 다되었을 때는 라운드 수에 맞춰 추정한다.
   타임 스탬프 정보를 가정하지 않는다. 실제로 해당 정보가 없는 경우가 많기 때문이다. 

2. 예측 목표

하나는 쿼리 비용을 유지하는 것이고, 하나는 예측 에러를 최소화하는 것이다. 
그리고 그 예측 에러는 예측 편향과 다양을 줄이는 것

## 재이슈-예측기
1. 여러 라운드를 위한 쿼리 리이슈
   - 정적 집계 예측의 간단한 모델
      : 쿼리 드릴 다운을 통한다. 
   - 쿼리 재이슈
   :한번만 드릴 다운 세트를 만들면 된다.
   - 쿼리 비용 아끼기
   : 어디가 오버플로우인지 파악했기 때문에, 해당 쿼리는 진행하지 않는 방향으로 쿼리 비용을 아낀다. 
   - 예측에 편향 없음
   : 정적 알고리즘에서의 편향없음을 보여준다. 
   At any round, for a given SUM or COUNT aggregate Q, we have E(π(ri)) = Q, where π(ri) is the estimation
     produced by REISSUE-ESTIMATOR from drill down ri, and E(·)
     is the expected value taken over the randomness of ri.

2. Reissue or Restart?
   
Reissue가 실제로 쿼리를 아껴주지만, 집계 예측은 또한 변한다는 걸 알아야한다. 그리고 이를 통해 만들어진 예측은, 서로 독립적이지 않아서, 정확한지 아닌지 따져봐야한다.
   
- 자극 예시
두가지 극단 예시들로, 비교해본다.
   - 데이터베이스에 변화가 없을 때
     - reissue의 경우 더 정확하게 가능하다. 변화가 없으므로 다른 드릴 다운을 더 많이 만들어낸다. 
     - restart보다 최대 50퍼의 다양성이 만들어진다.
   - 데이터베이스가 완전히 바뀔 때
     - 어짜피 다시 데이터베이스가 다시 만들어지는 것이므로, 정확도 조사가 더 간단하다.
     - 쿼리 비용만 고려하면 된다.여기서 reissue가 더 많은 쿼리를 만들어낸다는 것을 파악했다. 
     
- 이론적 분석
reissue가 더 비효율적일 경우는, 튜플이 데이터베이스에 삽입되지 않은 상태다.

## RS-예측기
재이슈-예측기의 문제는 데이터베이스가 조금의 변화가 있을 때다. 그래서 그를 보완할 RS-예측기를 제안한다.

1. 재이슈 예측기의 문제
데이터베이스에 변화가 없을 때, 각각의 드릴 다운은 두개의 쿼리가 필요하고, (하나는 확인용, 하나는 부모 확인용)
이럴 경우 추정 분산에 하한이 온다. 이 경우, 쿼리를 좀 더 처리해도 예측 에러를 줄이지는 않는다.

reservoir sampling으로 얼마나 많은 데이터가 있는지에 따라, 변화가 얼마나 일어날지 알 수 잇다. 비슷하게, 이 변화에 따라서 얼마나 많은 드릴다운이 업데이트 되어야하는지도 결정할 수 잇다.
그러나 그는 어떤 튜플이 삽입되었는지 알아야하고, 삽입 경우에만 파악할 수 잇어 한계가 있다.

2. RS-예측기의 메인 아이디어

쿼리 예산을 두부분으로 나눈다: 하나는 재이슈하는 것, 하나는 새 드릴다운을 시작할 때 새로 시작하는 것이다.
