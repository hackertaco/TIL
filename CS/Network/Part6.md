## 01. 스위치와 브리지
기본 동작에서는 별반 차이가 없다. 

## 02. 스패닝트리로 가는 첫번째 관문 2가지
1. 브리지 ID (중요)
   - 브리지 혹은 스위치도 아이디가 필요하다. 
   - 브리지나 스위치가 통신시 서로를 확인하는 용도다.
   - 총 8바이트로 구성되어있고, 2바이트는 브리지 우선순위, 나머지 6바이트는 맥 주소로 되어있다. 
2. Path Cost
   - 브리지나 스위치가 얼마나 가까이, 그리고 빠른 링크로 연결됐는지 알아보기 위함이다. 1000Mbps를 링크속도로 나눈다. 
   - 즉 링크 속도가 빠를수록 cost가 낮아진다.
   - 그러나, 다양한 속도가 나와서 소수점이 값으로 나오는 문제가 생겼다. 따라서 IEEE에서는 정해진 Path Cost를 사전에 정의했다.

## 03. 스패닝트리에서 기억할 것.
1) 네트워크 당 하나의 루트 브리지를 가진다.
2) 루트 브리지가 아닌 다른 모든 브리지는 무조건 하나씩의 루프 포트를 가진다. 
3) 세그먼트 당 하나의 designated port를 가진다. 

- 루트 포트: 루트 브리지에 가장 빨리 갈 수 있는 포트
- 세그먼트: 브리지나 스위치 간에 서로 연결된 링크, 서로 연결되어있으면 그 세그먼트에서 한 포트는 반드시 designated port여야 한다.
- 스패닝 프로토콜이란 이 3가지 규칙으로 어느쪽 링크를 살리고 끊을지 결정하는 과정이다. 
- STP에서, designated or root port 이외의 포트는 다 막는다. 

## 04. STP에서 힘 겨루기
1) 누가 더 작은 root bid? (서로 다른 네트워크일때)
2) 루트 브리지까지의 Path Cost 누가 제일 낮은지?
3) 누구의 BID가 더 낮은지
4) 누구의 포트 ID가 더 낮은지?

브리지나 스위치가 부팅을 하면, 이들은 각각의 포트로 BPDU라는 프레임을 매 2초마다 내보내 스패닝 트리 정보를 주고받는다.

## 05. 스위치에서 대장 브리지를 뽑기
더 낮은 BID가 루트 브리지가 되고, 자신의 BPDU에 그것을 기재한다. 
우선순위를 낮추면 간단히 루트 브리지가 될 수 있다.


## 06. 졸병 브리지 루트포트 선출
- 루트 포트는 루트 브리지에 가장 가까이 있는 포트다. 
- 졸병 브리지는 반드시 한개의 루트 포트를 가진다.
## 07. designated port 선출
브리지와 브리지 혹은 스위치와 스위치 사이 세그먼트 당 각 한개의 designated port가 필요하다. 
- 이는 루트브리지까지의 path cost가 작은 포트를 말한다. 사실상 루트 브리지의 모든 포트는 designated port 다.

그러나, 만약 cost가 같다면? 
1) 누가 더 작은 루트 BID를 가졌는지
2) 루트브리지까지의 path cost 작은쪽
3) 누구의 BID가 더 낮은지
4) 누구의 포트 id가 더 낮은지로 평가한다. 

## 08. 스패닝 TP의 다섯가지 상태변화
1) disabled: 포트고장이나 일부러 셧다운된 상태/ data 전송, 맥 주소, bpdu 전부 불가하다.
2) blocking: 스위치를 처음 켜거나 복구한 상태/data 전송, 맥 주소 불가하다. bpdu 가능
3) listening: 루트나 designated port가 되면 리스닝 상태가 된다. /data 전송, 맥 주소 불가하다. bpdu 가능
4) learning: 15초간 리스닝상태를 버티면/data 전송 불가, 맥 주소 가능. bpdu 가능
5) forwarding: 15초간 러닝 상태를 유지하면/ 전부 가능하다. 

-> 한 곳에서 다른 곳으로 가는 경로가 여러개일 때, 한 경로 빼고 다 끊었다가 해당 경로에 문제가 생기면 하나하나 살리는 것 : forwarding delay라고 하며, 위의 15초간 대기하는 것을 말한다.

## 09. 블로킹되면 통신이 불가하다.
## 10. 스패닝트리에 변화가 생기면
매 2초마다 루트는 루트가 아닌 곳으로 전송하는데, 지정된 시간동안 패킷이 전송되지 않으면 재편성된다. 
- hello time: 루트에서 다른 브리지로 디폴트 2초마다 시행
- Max age: 루트 브리지를 기다리는 시간
- Forwarding delay: 블로킹에서 포워딩하는 시간

1) 헬로 패킷이 없는 시간이 max age보다 커지면 다른 포트를 루트 포트로 선정한다. 
   - 이 경우 복구하는 데 max age + forwarding delay = 총 50초로 개선이 필요하다. 
   - 이를 개선할 IEEE 802.id spanning tree 사용
## 11. 카타리스트 스위치
## 12
스위치는 라우터와는 달리 구성이 딱히 없어도 사용이 가능하다. 
- 자동으로 루핑 팡지
- 기본 세팅이 되어있다. 
- 그런데 ip 주소를 세팅하는 이유는? 
- 제대로 관리하기 위해서다. 스위치는 네트워크를 나눌 수 없어서 모든 포트에 대표로 하나의 주소를 사용하고, vlan 인터페이스에서 주소를 배정한다. 
- 더불어 디폴트 게이트웨이를 설정해야한다. 

## 13 맥 주소 저장하는 곳
1. dynamic
2. permanant : 일정 시간이 지나도 사라지지 않는 주소 -> 스태틱 맥 주소

## 14. 가상의 랜이란? 
스위치 역할을 확장한다. 그는 브로드 캐스트 도메인이 커졌기 때문에, 그 도메인을 다시 나누려하기 때문이다. vlan 지원으로, 스위치가 여러 브로드캐스트 영역을 나눠줄 수 있다. 

## 15. vlan 기억할 것
-> 스위치에서 지원하는 기능
한대의 스위치를 여러개의 네트워크로 나누기 위해 사용한다. 나눠진 vlan 간의 소통은 라우터를 통해야 가능하다. 
- 트렁크 포트: 하나의 포트로 여러 vlan 전송하게 하는 포트
  - 패킷 전송 시, vlan 정보도 함께 전송된다. 

## 16. vlan에서의 트렁킹과 VTP
- VTP: 스위치들 간에 vlan 정보를 주고받아서 스위치가 가진 vlan 정보 동기화 해주는 프로토콜

VTP가 필요한 이유는 각 VLAN을 구별할 이름표가 필요하기 때문이다. 
- ISL
- IEEE\ 802.IQ: 표준
  - 네이티브 VLAN이라는 게 있다. 

모드는 세가지다
- 서버: vlan 생성, 삭제 전달.. NVRAM에서 정보를 관리한다.
- 클라이언트: 서버가 전해준 정보를 받고 전달만 가능하다. 리부팅시 초기화된다.
- 트랜스패런트: 자신이 서버에서 변화된 것을 다른 스위치에 알리지 않는 대신 중간에서 전달은 해준다. 한 스위치에서 만든 vlan을 그 스위치에서만 사용한다.]

메세지도 세가지다
- summary advertisement: vtp server- 5분마다 전달 revision num
- subset advertisement: client-> server가 advertisement req 날릴 때, vlan 구성이 변경되었을 때
- advertisement Request: 클라이언트가 서버에 서머리와 섭셋 요청시