병행: 같이 존재한다. = 메모리에 다수의 프로세스가 같이 존재한다.

단일처리 시스템 -> 병행 프로세스 중 한개만 실제로 실행. 하지만 겉으로 보았을 때는 동시에 처리되는 것처럼 보인다. 논리적 병행성
다중처리 시스템 -> 여러 개의 프로세스가 동시에 병렬로 실행될 수 있다. 물리적 병행성

병행 프로세스는 비동기적 -> 서로의 메모리 상태나 데이터를 잘 모르기에, 관리하지 못한 채 방치할 경우 문제가 생길 수 있음.

## 병행 프로세스
병행 프로세스는 메모리를 공유한다. 
자원의 접근에 대하여는 일정한 룰을 따라야한다. 한번에 한 프로세스만이 접근하도록 하고, 해당 자원에 대해 의도한 실행을 완료하도록 보장한다.
이 접근이 제대로 처리되지않으면, 정확한 값을 가질 수 없게 될 수 있다.

## 상호 배제
공유 데이터에 여러 프로세스들이 접근을 시도하는 상황을 경쟁 상태라고 하며, 이를 잘 해결하기위해 프로세스들끼리 상호배제를 해야한다.
동시에 사용할 수 없는 자원을 임계자원이라 부르고, 그 코드 영역을 임계 영역이라 부른다. 
임계영역의 실행을 위해서는 상호배제가 지켜져야한다.
임계영역에 없는 프로세스가 다른 영역의 임계영역 프로세스 접근하는 것을 막는 것은 안되고, 
빈 임계영역 진입은 바로 허용하되, 시도가 무산되어 기아를 겪지 않도록 한다.
이미 들어가있다면 기다리고, 없다면 들어가면서 다른 프로세스가 들어오지 않도록 해야한다.

 ### 상호배제 잘못된 시도들
1. turn 값을 프로세스별로 다른 상황일 때 임계영역에 들어갈 수 있을 때
   이 경우 턴 값이 0일 때는 항상 일정한 프로세스만이 먼저 시작 가능.
   번갈아 한번씩만 실행될 수 있음.
   
2. flag를 두어서 true/false로 구분하는 방식은 1의 문제를 해결할 수는 있지만, 둘 다 동시에 임계영역에 들어갈 수 있게 된다.
3. flag 위치를 변경하게되어도, 둘 다 임계 영역에 진입하지 못하게되는 문제가 있다. 
4. 라이브락: 시점에 조금 잘못이 생기면 임계 영역에 진입이 불가하다.

### 상호배제 성공적인 기법
turn과 flag 모두를 사용한 기법. 데커가 너무 어렵게 만들어놓은 것을 피터슨이 쉽게 바꾸었다.

### n 프로세스 간의 상호배제를 위한 소프트웨어 기법
여러개의 프로세스끼리의 상호배제를 위한 기법 중, 베이커리 알고리즘은 분산시스템용으로도 소개되었으나 n개의 프로세스들을 대상으로 하는 상호배제 기법으로도 유용하다.


이러한 기법들은 운영체제의 지원이 아니라, 프로세스 간 협력을 통해 상호배제를 실현하는 것이라 실행 시 부하가 크고, 실수로 인한 오류의 가능성도 높다.

## 상호 배제를 위한 하드웨어 기법들
### 인터럽트 금지를 사용한 기법
단일처리 시스템의 경우 CPU를 번갈아 사용하는 것이라, 한 프로세스가 임계영역에서 실행 중일 때, 인터럽트를 넣어줘서 상호배제를 지켜줄 수 있다. 
근데 이 경우 모든 종류의 인터럽트를 금지하게 되어 효율적이지 않을 수 있다.
다중처리 시스템에서는 다른 처리기에서 실행되는 프로세스로부터의 접근 가능성이 있어서, 사용하기 힘들다. 

그래서, 하드웨어의 명령어로 이를 해결해보고자한다. 
### 하드웨어 명령어를 사용한 기법 
- testandset
- exchange
이용해서, 전역 변수를 활용한 상호배제 알고리즘을 만든다. 
- 기계 명령어를 이용하면 간단하고, 다중처리 시스템에서도 쉽게 쓸 수 있다. 여러개의 임계영역도 지원 가능하다. 
- 그러나, 여전히 바쁜 대기를 하고, 차례가 정해지지않아 어떤 프로세스는 기아를 겪고, 높은 우선순위 프로세스에 CPU를 뺏기면 교착 상태에 빠질수도있다.

## 세마포어
세 개의 특수한 명령들만 접근할 수 있게 허용되는 보호된 변수.
- 프로그래밍 언어와 운영체제 수준에서 병행성을 위해 제공되는 기법 -> 높은 수준

변수가 가질 수 있는 값의 범위에 따라 종류가 달라진다.
1. 이진 세마포어: 가질 수 있는 값은 0 아니면 1
2. 정수 세마포어: 음이 아닌 모든 정수가 될 수 있다면.

세마포어를 위한 특수한 명령들은
1. 세마포어 값을 초기화 하는 명령
2. P명령: S값이 0보다 크면 S값을 1 감소시키고 0보다 작으면 대기를 한다.
3. V명령: 큐에서 대기중인 프로세스가 있다면 그를 실행시키고, 아니라면 S값을 1 증가시킨다.

P와 V는 세마포어인 S만을 매개변수라고 한다. 
명령들이 각각 분리되지 않고 수행돼야 하고, 같은 세마포어에 대해서 동시에 실행되지는 못한다.

- 이를 이용하면, 상호 배제를 구현하고 또 프로세스 간의 동기화도 구현할 수 있다. 
  - 이진 세마포어로 P와 V를 상호 의존적으로 만드는 것이다.
  
## 생산자-소비자 문제
버퍼라는 공유 자원을 중심으로, 생산자는 데이터를 만들어 버퍼에 저장, 소비자는 데이터를 버퍼에서 꺼내 소비한다.
이 때 버퍼에 대한 접근은 상호배제되어야 한다.
- 명령어의 위치가 세심히 조절되어야한다.
- 세마포어를 사용하는 기법은 임계영역으로의 진입을 기다리는 프로세스들을 대기상태로 전환시켜 바쁜 대기를 할 때의 CPU 낭비를 없앨 수 있다. 
  - 그러나, 대기상태로 만드는 비용을 생각해보아야하고, 
  - 임계영역이 짧게 끝나도 바쁜 대기에 비하여 프로세스의 반응이 즉각적이지는 못하다.
  - 또한 다음 차례의 기준이 없어 오래도록 기다리는 프로세스들의 기아를 유발할 수 있다. 
  
## Eventcount Sequencer를 사용한 기법
- 초기 값은 0으로 시작하고, 그 값이 감소하지않는다. 
- Eventcount에 대한 변수에 읽기, 1 증가하기, 현재 변수보다 특정값이 작으면 기다리기 기능이있다.
- ticket이라는 명령은 Sequencer 변수를 반환하고 실행될 때마다 변수값은 증가한다. 
- 이는 오래 기다린 프로세스들의 기아를 보완하는 역할을 한다. 
- 그러나, 1증가시키는 명령을 제대로 해주지않으면 심각한 오류가 생기게된다.

## 모니터
공유 데이터들과 그에 대한 임계 영역을 관리하는 소프트웨어 구성체.

모니터 내의 변수들은 프로시저들을 통해서만 접근이 가능하다. 
따라서 프로세스들은 이 프로시저를 호출하고 실행하여 공유 데이터에 대한 접근을 하게된다. 

- 한번에 하나 이하의 프로세스만이 모니터 내에 있게 하며 상호배제를 자연스럽게 실현한다. 
  - 이미 한 프로세스가 들어가 있을 때를 대비하여 호출될 프로시저 개수만큼의 대기 큐가 있어야한다. 
  - 또한, 모니터 내의 프로세스가 실행 중 특정 조건 때문에 대기해야할 경우, 모니터를 양보해서 밖의 조건 큐에 있어야한다. 
  - 조건을 만족하는 프로세스는 그 조건을 기다리던 프로세스의 모니터 진입을 위하여 잠시 모니터를 비켜주는데, 그를 신호자 대기 큐라 한다.
  - 조건의 대기는 cwait(), 대기되었던 프로세스를 csignal()로 재개. 
- 스풀링을 위한 스풀러, 디스풀러 프로세스 간에 많이 쓰인다.
  - 스풀러: 디스크같은 보조기억 장치에 빠른 속도로 출력을 하는 
  - 디스풀러: 디스크에 임시 출력된 내용을 실제로 프린트하는 프로세스. 
  - 디스풀러가 스풀러보다 느린데, 이 두 프로세스 간의 속도 차이를 완화해준다. 